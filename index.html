<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>DIÁRIO DO GRÊMIO ESTUDANTIL</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

:root{
--primary:#00a896;
--secondary:#0077b6;
--dark:#1d2d35;
--bg:#eef4f7;
}

body{
margin:0;
background:var(--bg);
font-family:Segoe UI,Arial;
}

/* CARD BASE */
.container{
background:white;
width:95%;
max-width:850px;
margin:35px auto;
padding:30px;
border-radius:12px;
box-shadow:0 10px 30px rgba(0,0,0,0.15);
border-top:8px solid var(--primary);
}

/* TOPO COM LOGOS */
.header-logos{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:25px;
border-bottom:1px dashed #ccc;
padding-bottom:15px;
}

.header-logos img{
max-height:95px;
object-fit:contain;
}

/* TITULOS */
h2{
text-align:center;
color:var(--dark);
letter-spacing:1px;
font-weight:700;
}

/* CAMPOS */
.form-group{margin-bottom:15px;}

label{
font-weight:700;
color:#555;
}

input,select,textarea{
width:100%;
padding:10px;
border-radius:6px;
border:1px solid #ccc;
font-size:15px;
background:#fafafa;
}

input:focus,textarea:focus,select:focus{
outline:none;
border:1px solid var(--secondary);
box-shadow:0 0 4px var(--secondary);
}

/* BOTÕES */
button{
width:100%;
padding:13px;
border-radius:6px;
border:none;
font-weight:700;
cursor:pointer;
transition:.2s;
color:white;
}

.btn-save{background:var(--primary);}
.btn-save:hover{transform:scale(1.02);}

.btn-log{background:#495057;margin-top:15px;}
.btn-log:hover{transform:scale(1.02);}

.btn-danger{background:#c82333;}
.btn-danger:hover{transform:scale(1.02);}

/* LOGS */
.table-container{
margin-top:25px;
overflow-x:auto;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:#f8f9fa;
padding:12px;
border-bottom:2px solid #ddd;
}

td{
padding:10px;
border-bottom:1px solid #eee;
}

/* ESCONDER TELA */
.hidden{display:none;}

.badge-download{
background:var(--primary);
color:white;
padding:7px 12px;
border-radius:5px;
border:none;
cursor:pointer;
}

</style>
</head>

<body>

<div id="login-screen" class="container">

<div class="header-logos">
<img src="BRASAO_ESCOLA.png">
<img src="LOGO_GREMIO.png">
</div>

<h2>ACESSO AO DIÁRIO DO GRÊMIO ESTUDANTIL</h2>

<div class="form-group">
<label>USUÁRIO</label>
<input id="user">
</div>

<div class="form-group">
<label>SENHA</label>
<input type="password" id="pass">
</div>

<button onclick="handleLogin()" class="btn-save">ENTRAR</button>
</div>




<div id="dashboard" class="container hidden">

<div style="text-align:right;">
<span id="user-display" style="font-size:12px;font-weight:bold;"></span> |
<a onclick="location.reload()" style="color:#c82333;font-size:12px;cursor:pointer;">Sair</a>
</div>

<h2>CADASTRAR AÇÔES GRÊMIO ESTUDANTIL </h2>

<div class="form-group">
<label>TÍTULO AÇÃO</label>
<input id="titulo">
</div>

<div style="display:flex;gap:10px;">
<div class="form-group" style="flex:1">
<label>DATA</label>
<input type="date" id="data">
</div>

<div class="form-group" style="flex:1">
<label>NÚMERO DE ALUNOS</label>
<input type="number" id="qtd">
</div>
</div>

<div class="form-group">
<label>ORIGEM</label>
<select id="proposta">
<option value="Grêmio">GRÊMIO</option>
<option value="Gestão Escolar">GESTÃO ESCOLAR</option>
<option value="GRESP / SEDUC">GRESP / SEDUC</option>
</select>
</div>

<div class="form-group">
<label>TEMA</label>
<input id="tema">
</div>

<div class="form-group">
<label>DESCRIÇÃO COMPLETA</label>
<textarea rows="4" id="descricao"></textarea>
</div>

<button class="btn-save" onclick="salvarAcao()">SALVAR REGISTROS</button>
<button class="btn-log" onclick="acessarLogs()">VER HISTÓRICO</button>
</div>




<div id="logs-screen" class="container hidden">

<h2>HISTÓRICOS DE REGISTROS</h2>

<div style="display:flex;justify-content:space-between;">
<button onclick="voltarDash()" style="background:#343a40;width:auto;padding:10px 20px;border-radius:6px;">Voltar</button>
<button class="btn-danger" onclick="limparBanco()">Limpar Tudo</button>
</div>

<div class="table-container">
<table>
<thead>
<tr>
<th>DATA/HORA</th>
<th>AUTOR</th>
<th>AÇÃO</th>
<th>DOWNLOUD</th>
</tr>
</thead>
<tbody id="log-table-body"></tbody>
</table>
</div>

</div>



<script>

const { jsPDF } = window.jspdf;
const users = { "admin":"1234","gremio":"gremio123" };
const DB_NAME = "gremio_db_v6";
let loggedUser = "";

/* LOGIN */
function handleLogin(){
const u = user.value;
const p = pass.value;
if(users[u]===p){
loggedUser=u;
login-screen.classList.add("hidden");
dashboard.classList.remove("hidden");
user-display.innerText="Usuário: "+u;
}else alert("Login inválido");
}

/* SALVAR */
function salvarAcao(){
if(!titulo.value || !data.value) return alert("Título e Data são obrigatórios!");

const registro = {
id:Date.now(),
autor:loggedUser,
dataReg:new Date().toLocaleDateString("pt-BR"),
horaReg:new Date().toLocaleTimeString("pt-BR"),
titulo:titulo.value,
dataAcao:data.value,
qtd:qtd.value || "Não informado",
proposta:proposta.value,
tema:tema.value || "Não informado",
descricao:descricao.value || "Sem descrição"
};

let logs = JSON.parse(localStorage.getItem(DB_NAME)||"[]");
logs.push(registro);
localStorage.setItem(DB_NAME,JSON.stringify(logs));

alert("Ação registrada!");
document.querySelectorAll("input,textarea").forEach(i=>i.value="");
}

/* LOGS */
function acessarLogs(){
if(prompt("Senha do Administrador:")!=="0000") return alert("Acesso negado!");
dashboard.classList.add("hidden");
logs-screen.classList.remove("hidden");
renderLogs();
}

function renderLogs(){
const tbody=document.getElementById("log-table-body");
const logs=JSON.parse(localStorage.getItem(DB_NAME)||"[]").filter(l=>l.titulo);
tbody.innerHTML="";
if(!logs.length) return tbody.innerHTML="<tr><td colspan='4' style='text-align:center'>Nenhum registro</td></tr>";

logs.reverse().forEach(l=>{
tbody.innerHTML+=`
<tr>
<td>${l.dataReg} ${l.horaReg}</td>
<td><b>${l.autor}</b></td>
<td>${l.titulo}</td>
<td><button class="badge-download" onclick="gerarPDF(${l.id})">PDF</button></td>
</tr>`;
});
}

/* PDF */
function gerarPDF(id){

const logs = JSON.parse(localStorage.getItem(DB_NAME)||"[]");
const d = logs.find(l=>l.id===id);
if(!d) return;

const doc = new jsPDF();

/* Cabeçalho */
doc.setFillColor(0,168,150);
doc.rect(0,0,210,35,"F");

doc.addImage("BRASAO_ESCOLA.png","PNG",10,5,30,25);
doc.addImage("LOGO_GREMIO.png","PNG",165,5,35,25);

doc.setTextColor(255,255,255);
doc.setFontSize(18);
doc.text("RELATÓRIO DE AÇÃO ESTUDANTIL",105,22,{align:"center"});

/* Corpo */
doc.setTextColor(0,0,0);
doc.setFontSize(12);

doc.text("Escola: E.E Profº João Teixeira Sampaio",20,50);
doc.text("Grêmio: Geração Consciente",20,58);

doc.text(`Título: ${d.titulo}`,20,74);
doc.text(`Data: ${d.dataAcao}`,20,84);
doc.text(`Participantes: ${d.qtd}`,20,94);
doc.text(`Proposta: ${d.proposta}`,20,104);
doc.text(`Tema: ${d.tema}`,20,114);

doc.line(20,120,190,120);
doc.text("Descrição da Atividade:",20,130);

const linhas = doc.splitTextToSize(d.descricao,170);
doc.text(linhas,20,140);

doc.setFontSize(9);
doc.text(`Emitido em ${d.dataReg} às ${d.horaReg} por ${d.autor}`,20,285);

doc.save(`Relatorio_${d.titulo}.pdf`);
}

function limparBanco(){
if(confirm("Deseja realmente apagar tudo?")){
localStorage.removeItem(DB_NAME);
renderLogs();
}
}

function voltarDash(){
logs-screen.classList.add("hidden");
dashboard.classList.remove("hidden");
}

</script>
</body>
</html>
